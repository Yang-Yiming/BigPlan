# BigPlans æœ¬åœ°æµ‹è¯•ä¸éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†æ•™ä½ å¦‚ä½•åœ¨æœ¬åœ°æµ‹è¯• BigPlans åº”ç”¨ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åˆ° Cloudflare Workersã€‚

## ğŸ“‹ ç›®å½•

1. [æœ¬åœ°æµ‹è¯•](#æœ¬åœ°æµ‹è¯•)
2. [éƒ¨ç½²åˆ° Cloudflare](#éƒ¨ç½²åˆ°-cloudflare)
3. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æœ¬åœ°æµ‹è¯•

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd BigPlans

# å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…
npm install
```

### ç¬¬äºŒæ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# åˆ›å»º .env æ–‡ä»¶
touch .env
```

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```env
VITE_API_BASE_URL=http://localhost:8787/api
JWT_SECRET=your-super-secret-key-change-this-in-production
PORT=3000
```

> **é‡è¦æç¤º**ï¼š`JWT_SECRET` æ˜¯ç”¨äºåŠ å¯†ç”¨æˆ·ç™»å½•ä»¤ç‰Œçš„å¯†é’¥ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¯·åŠ¡å¿…ä½¿ç”¨ä¸€ä¸ªå®‰å…¨çš„éšæœºå­—ç¬¦ä¸²ï¼

### ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®æœ¬åœ°æ•°æ®åº“

```bash
# 1. ç”Ÿæˆæ•°æ®åº“è¿ç§»æ–‡ä»¶
npm run db:generate

# 2. æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼ˆåˆ›å»ºè¡¨ç»“æ„ï¼‰
npm run db:migrate

# 3. ï¼ˆå¯é€‰ï¼‰æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢æŸ¥çœ‹æ•°æ®
npm run db:studio
```

è¿è¡Œ `npm run db:studio` åï¼Œä¼šåœ¨æµè§ˆå™¨æ‰“å¼€ `https://local.drizzle.studio`ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å’Œç®¡ç†æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚

### ç¬¬å››æ­¥ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨

**éœ€è¦åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯ä¸¤ä¸ªæœåŠ¡**ï¼Œå»ºè®®ä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯çª—å£ï¼š

**ç»ˆç«¯ 1 - å¯åŠ¨å‰ç«¯ï¼š**
```bash
npm run dev
```

å‰ç«¯ä¼šåœ¨ `http://localhost:5173` å¯åŠ¨

**ç»ˆç«¯ 2 - å¯åŠ¨åç«¯ï¼š**
```bash
npm run dev:server
```

åç«¯ API ä¼šåœ¨ `http://localhost:8787` å¯åŠ¨

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•åŠŸèƒ½

åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:5173`ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢ã€‚

**æµ‹è¯•æµç¨‹ï¼š**

1. **æ³¨å†Œè´¦æˆ·**
   - ç‚¹å‡»"æ³¨å†Œ"
   - è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   - æäº¤æ³¨å†Œ

2. **ç™»å½•ç³»ç»Ÿ**
   - ä½¿ç”¨åˆšæ‰æ³¨å†Œçš„è´¦æˆ·ç™»å½•

3. **æµ‹è¯•ä»»åŠ¡åŠŸèƒ½**
   - åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡
   - æ›´æ–°ä»»åŠ¡è¿›åº¦
   - åˆ é™¤ä»»åŠ¡

4. **æµ‹è¯• KISS å¤ç›˜**
   - ç‚¹å‡»"KISS å¤ç›˜"æ ‡ç­¾
   - å¡«å†™æ¯æ—¥åæ€
   - ä¿å­˜

5. **æµ‹è¯•ç¾¤ç»„åŠŸèƒ½**
   - åˆ›å»ºä¸€ä¸ªç¾¤ç»„
   - å¤åˆ¶é‚€è¯·ç 
   - ç”¨å¦ä¸€ä¸ªè´¦æˆ·åŠ å…¥ç¾¤ç»„ï¼ˆéœ€è¦å…ˆé€€å‡ºç™»å½•ï¼Œæ³¨å†Œæ–°è´¦æˆ·ï¼‰

---

## éƒ¨ç½²åˆ° Cloudflare

### å‰ç½®å‡†å¤‡

1. **æ³¨å†Œ Cloudflare è´¦æˆ·**
   - è®¿é—® [https://dash.cloudflare.com/sign-up](https://dash.cloudflare.com/sign-up)
   - å®Œæˆæ³¨å†Œæµç¨‹

2. **å®‰è£… Wrangler CLI**

   Wrangler æ˜¯ Cloudflare çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå·²ç»ä½œä¸ºé¡¹ç›®ä¾èµ–å®‰è£…ã€‚

3. **ç™»å½• Cloudflare**

   ```bash
   npx wrangler login
   ```

   è¿™ä¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼ŒæŒ‰ç…§æç¤ºå®Œæˆç™»å½•ã€‚

### æ­¥éª¤ä¸€ï¼šåˆ›å»ºç”Ÿäº§æ•°æ®åº“

```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒçš„ D1 æ•°æ®åº“
npx wrangler d1 create bigplans-db-prod
```

æ‰§è¡Œåï¼ŒWrangler ä¼šè¿”å›æ•°æ®åº“ä¿¡æ¯ï¼Œç±»ä¼¼è¿™æ ·ï¼š

```
âœ… Successfully created DB 'bigplans-db-prod'

[[d1_databases]]
binding = "DB"
database_name = "bigplans-db-prod"
database_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
```

**å¤åˆ¶ `database_id`**ï¼Œä¸‹ä¸€æ­¥ä¼šç”¨åˆ°ã€‚

### æ­¥éª¤äºŒï¼šæ›´æ–° Wrangler é…ç½®

æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•çš„ `wrangler.toml` æ–‡ä»¶ï¼Œæ‰¾åˆ° `[env.production]` éƒ¨åˆ†ï¼š

```toml
[env.production]
name = "bigplans-prod"

[[env.production.d1_databases]]
binding = "DB"
database_name = "bigplans-db-prod"
database_id = "æ›¿æ¢æˆä½ çš„ database_id"  # â† æŠŠè¿™é‡Œæ›¿æ¢æˆä¸Šä¸€æ­¥å¤åˆ¶çš„ database_id
```

### æ­¥éª¤ä¸‰ï¼šæ‰§è¡Œç”Ÿäº§æ•°æ®åº“è¿ç§»

```bash
# åœ¨ç”Ÿäº§æ•°æ®åº“ä¸­åˆ›å»ºè¡¨ç»“æ„
npm run db:migrate:prod
```

è¿™ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“ä¸­åˆ›å»ºæ‰€æœ‰éœ€è¦çš„è¡¨ã€‚

### æ­¥éª¤å››ï¼šè®¾ç½® JWT å¯†é’¥

```bash
# ä¸ºç”Ÿäº§ç¯å¢ƒè®¾ç½® JWT å¯†é’¥ï¼ˆè¿™æ˜¯ä¸€ä¸ªåŠ å¯†å¯†é’¥ï¼Œè¯·ä½¿ç”¨éšæœºå­—ç¬¦ä¸²ï¼‰
npx wrangler secret put JWT_SECRET --env production
```

æ‰§è¡Œåä¼šæç¤ºä½ è¾“å…¥å¯†é’¥çš„å€¼ï¼Œè¾“å…¥ä¸€ä¸ªå¼ºå¯†ç ï¼ˆå»ºè®®è‡³å°‘ 32 ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²ï¼‰ã€‚

**ç”Ÿæˆéšæœºå¯†é’¥çš„æ–¹æ³•ï¼š**

```bash
# macOS/Linux
openssl rand -base64 32

# æˆ–è€…åœ¨ Node.js ä¸­
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

### æ­¥éª¤äº”ï¼šæ„å»ºå‰ç«¯

```bash
# æ„å»ºç”Ÿäº§ç¯å¢ƒçš„å‰ç«¯ä»£ç 
npm run build:prod
```

è¿™ä¼šåœ¨ `dist` ç›®å½•ç”Ÿæˆä¼˜åŒ–åçš„å‰ç«¯æ–‡ä»¶ã€‚

### æ­¥éª¤å…­ï¼šéƒ¨ç½²åˆ° Cloudflare

```bash
# éƒ¨ç½²åˆ° Cloudflare Workers
npm run wrangler:deploy
```

éƒ¨ç½²æˆåŠŸåï¼ŒWrangler ä¼šè¿”å›ä½ çš„åº”ç”¨ URLï¼Œç±»ä¼¼ï¼š

```
âœ¨ Deployment complete! Your worker is available at:
   https://bigplans-prod.your-subdomain.workers.dev
```

### æ­¥éª¤ä¸ƒï¼šé…ç½®å‰ç«¯ API åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œä½ éœ€è¦æ›´æ–°å‰ç«¯çš„ API åœ°å€ã€‚

1. æ‰“å¼€ `.env` æ–‡ä»¶
2. å°† `VITE_API_BASE_URL` æ”¹ä¸ºä½ çš„ç”Ÿäº§ç¯å¢ƒ URLï¼š

```env
VITE_API_BASE_URL=https://bigplans-prod.your-subdomain.workers.dev/api
```

3. é‡æ–°æ„å»ºå¹¶éƒ¨ç½²ï¼š

```bash
npm run build:prod
npm run wrangler:deploy
```

### æ­¥éª¤å…«ï¼šæµ‹è¯•ç”Ÿäº§ç¯å¢ƒ

è®¿é—®ä½ çš„ç”Ÿäº§ç¯å¢ƒ URLï¼Œæµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

---

## å¸¸è§é—®é¢˜

### Q1: æœ¬åœ°å¼€å‘æ—¶ï¼Œå‰ç«¯æ— æ³•è¿æ¥åˆ°åç«¯ API

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆ`npm run dev:server`ï¼‰
2. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `VITE_API_BASE_URL` æ˜¯å¦ä¸º `http://localhost:8787/api`
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯

### Q2: éƒ¨ç½²æ—¶æç¤º "database_id is required"

**è§£å†³æ–¹æ³•ï¼š**
ç¡®ä¿ä½ åœ¨ `wrangler.toml` çš„ `[env.production]` éƒ¨åˆ†æ­£ç¡®å¡«å†™äº† `database_id`ã€‚

### Q3: ç™»å½•åæç¤º"token æ— æ•ˆ"

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥æ˜¯å¦æ­£ç¡®è®¾ç½®äº† JWT_SECRET
2. æœ¬åœ°å¼€å‘æ—¶æ£€æŸ¥ `.env` æ–‡ä»¶
3. ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ˜¯å¦æ‰§è¡Œäº† `npx wrangler secret put JWT_SECRET --env production`

### Q4: éƒ¨ç½²åæ•°æ®åº“ä¸ºç©º

**è§£å†³æ–¹æ³•ï¼š**
ç¡®ä¿æ‰§è¡Œäº† `npm run db:migrate:prod` æ¥åœ¨ç”Ÿäº§æ•°æ®åº“ä¸­åˆ›å»ºè¡¨ç»“æ„ã€‚

### Q5: å¦‚ä½•æŸ¥çœ‹ç”Ÿäº§æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Ÿ

```bash
# è¿æ¥åˆ°ç”Ÿäº§æ•°æ®åº“
npx wrangler d1 execute bigplans-db-prod --env production --command "SELECT * FROM users"
```

### Q6: å¦‚ä½•æ›´æ–°ç”Ÿäº§ç¯å¢ƒçš„ä»£ç ï¼Ÿ

æ¯æ¬¡ä¿®æ”¹ä»£ç åï¼Œé‡æ–°æ‰§è¡Œï¼š

```bash
npm run build:prod
npm run wrangler:deploy
```

### Q7: å¦‚ä½•å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Ÿ

Cloudflare Workers ä¼šä¿ç•™å†å²ç‰ˆæœ¬ï¼Œä½ å¯ä»¥åœ¨ Cloudflare Dashboard ä¸­æ‰‹åŠ¨å›æ»šï¼š

1. è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ Workers & Pages
3. é€‰æ‹©ä½ çš„ Worker
4. åœ¨ Deployments æ ‡ç­¾ä¸­é€‰æ‹©ä¹‹å‰çš„ç‰ˆæœ¬å¹¶å›æ»š

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å·²ç»æˆåŠŸåœ¨æœ¬åœ°æµ‹è¯•å¹¶éƒ¨ç½²äº† BigPlans åº”ç”¨åˆ° Cloudflareï¼

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®çš„ GitHub Issues æˆ–æäº¤æ–°çš„é—®é¢˜ã€‚
